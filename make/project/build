#
# compile flags
#

TIME	:=	$(shell date "+%F %R")

CFLAGS	+=	-std=gnu99 -Werror \
			-fomit-frame-pointer -ffast-math \
			-I$(A2X_PATH)/lib \
			-DA_COMPILE_TIME=\"'$(TIME)'\"

#
# the main target
#

all : $(NAME)

$(NAME) : $(DIRS) $(C_GFX_FILES) $(C_SFX_FILES) $(OFILES)
	$(CC) -o $(NAME) $(OFILES) $(A2X_PATH)/lib/a2x_$(PLATFORM).a $(LIBS)

#
# make all the needed dirs
#

$(O_DIR) :
	mkdir $@

$(O_GFX_DIR) :
	mkdir $@

$(O_SFX_DIR) :
	mkdir $@

$(C_GFX_DIR) :
	mkdir $@

$(C_SFX_DIR) :
	mkdir $@

#
# pattern rules for building the universe
#

$(C_GFX_DIR)/%.c : $(GFX_DIR)/%.png
	$(A2X_PATH)/tools/a2x_gfx $< $@ $(@:.c=.h)

$(C_SFX_DIR)/%.c : $(SFX_DIR)/%.wav
	$(A2X_PATH)/tools/a2x_sfx $< $@ $(@:.c=.h)

$(O_DIR)/%.o : $(SRC_DIR)/%.c
	$(CC) -c -o $@ $< $(CFLAGS)

$(O_GFX_DIR)/%.o : $(C_GFX_DIR)/%.c
	$(CC) -c -o $@ $< $(CFLAGS)

$(O_SFX_DIR)/%.o : $(C_SFX_DIR)/%.c
	$(CC) -c -o $@ $< $(CFLAGS)

#
# clean-up rule that deletes all .o files
#

clean :
	rm -rf $(NAME) $(O_DIR)

#
# clean-up rule that deletes all .o files and all generated .c files
#

realclean :
	rm -rf $(NAME) $(DIRS)

#
# run the program
#

run : all
	cd $(TARGET_DIR) ; ./$(APP)
